<tool id="qcxms_neutral_run" name="QCxMS neutral run" version="@TOOL_VERSION@+galaxy0" python_template_version="3.5" profile="21.05">
    <description>required as first step to prepare for the production runs</description>
    
    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="creator"/>

    <edam_topics>
        <edam_topic>topic_3332</edam_topic>
    </edam_topics>
    <edam_operations>
        <edam_operation>operation_0297</edam_operation>
    </edam_operations>

    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">qcxms</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        ln $mol molecule.xyz &&
        cat qcxms.in &&
        qcxms -i molecule.xyz >> $log &&
        qcxms -i molecule.xyz >> $log
    ]]></command>

    <environment_variables>
        <environment_variable name="OMP_NUM_THREADS">1</environment_variable>
    </environment_variables>

    <configfiles>
        <configfile filename="qcxms.in"><![CDATA[
            ${QC_Level}
            #if $keywords.ntraj
            ntraj  ${keywords.ntraj}
            #end if
            tmax  ${keywords.tmax} 
            tinit  ${keywords.tinit} 
            ieeatm  ${keywords.ieeatm}]]>
        </configfile>
    </configfiles>

    <inputs>
        <param type="data" name="mol" label="Molecule 3D structure [.xzy]" format="xyz" />
        <param name="QC_Level" type="select" display="radio" label="QC Method">
            <option value="xtb2" selected="true">GFN2-xTB</option>
            <option value="xtb">GFN-xTB</option>
        </param>
        <section name="keywords" title="Advanced method parameters" expanded="false" 
            help="List of advanced keywords to specify the method - for more information see [1].">
            <param name="tmax" type="float" value="20.0" label="Maximum MD time (sampling) [ps]"
            help="MD time for the mean-free-path (mfp) simulation in the EI mode. In the CID mode, this sets the number of time steps for the simulation 
            after fragmentation during internal energy scaling (implicit run type). For the explicit run type, the time for the collision MDs is fixed at 50 fs * number_of_atoms."/>
            <param name="tinit" type="float" value="500.0" label="Initial Temperature [K]"/>
            <param name="ieeatm" type="float" value="0.6" label="Impact excess energy (IEE) per atom [eV/atom]" />
            <param name="ntraj" type="integer" optional="true" min="1" label="Number of trajectories[#]" help="Default is 25 * no. of atoms if unspecified."/>
        </section>
        <param name="store_extended_output" type="boolean" value="false" label="Store additional outputs?" help="Output the logfile and generated trajectory."/>
    </inputs>

    <outputs>
        <data name="qcxms_out" format="txt" from_work_dir="qcxms.gs" label="qcxms.gs generated by ${tool.name} on ${on_string}">
            <filter>store_extended_output</filter>
        </data>
        <data name="trajectory" from_work_dir="trjM" format="txt" label="trajectories generated by ${tool.name} on ${on_string}">
            <filter>store_extended_output</filter>
        </data>
        <data name="log" format="txt" label="logfile of ${tool.name} on ${on_string}">
            <filter>store_extended_output</filter>
        </data>


        <collection name="coords" type="list">
            <discover_datasets pattern="__designation_and_ext__" format="xyz" directory="TMPQCXMS" recurse="true"/>
        </collection>

    </outputs>

    <help><![CDATA[]]>
    </help>

    <citations>
        <citation type="doi">10.1002/anie.201300158</citation>
        <citation type="doi">10.1039/C4OB01668H</citation>
        <citation type="doi">10.1021/jp5096618</citation>
        <citation type="doi">10.1255/ejms.1313</citation>
        <citation type="doi">10.1021/acs.jpca.6b02907</citation>
    </citations>
</tool>