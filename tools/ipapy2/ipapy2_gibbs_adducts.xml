<tool id="ipapy2_gibbs_adducts" name="IPA gibbs sampler adducts" version="@TOOL_VERSION@+galaxy0" python_template_version="3.5" profile="21.05">
    <macros>
        <import>macros.xml</import>
    </macros>
    
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">ipapy2</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        python3 '${ipapy2_gibbs_adducts_cli}'
    ]]></command>

    <configfiles>
<configfile name="ipapy2_MS1_annotation_cli">
@init_import@

df = pd.read_csv('${MS1_table}', keep_default_na=False)
df = df.replace('', None)
annotations = pd.read_csv('${annotations}', keep_default_na=False)
annotations = annotations.replace('', None)
zs = ipa.Gibbs_sampler_add(df, annotations, noits=$noits, burn=$burn, delta_add=$delta_add, all_out=$all_out, zs=$zs)
</configfile>
</configfiles>

    <inputs>
        <param label="MS1 table" name="MS1_table" type="data" format="csv" help="pandas dataframe containing the MS1 data."/>
        <param label="annotations" name="annotations" type="data" format="csv" help="pandas dataframe containing all the possible annotations for the measured features."/>
        <param label="gibbs sampler iterations" name="noits" type="integer" value="100" help="number of iterations if the Gibbs sampler to be run."/>
        <param label="ignored iterations" name="burn" type="integer" help="number of iterations to be ignored when computing posterior probabilities. If None, is set to 10% of total iterations."/>
        <param label="adducts weight" name="delta_add" type="float" value="1" min="0" help="parameter used when computing the conditional priors. The parameter must be positive. The smaller the parameter the more weight the adducts connections have on the posterior probabilities. Default 1."/>
        <param label="return each iteration" name="all_out" type="boolean" value="false" help="logical value. If true the list of assignments found in each iteration is returned by the function. Default False."/>
        <param label="previous Gibbs sampler" name="zs" type="data" help="list of assignments computed in a previous run of the Gibbs sampler. Optional, default None."/>
    </inputs>

    <outputs>
        <data label="${tool.name} annotations on ${on_string}" name="annotations" format="csv"/>
        <data label="${tool.name} zs on ${on_string}" name="zs_out" optional="true"/>
    </outputs>

        <tests>
        <test>
            <param name="MS1_table" value="MS1_data.csv"/>
            <param name="all_adducts" value="all_adducts.csv"/>
            <param name="ppm" value="3"/>
            <output name="output" file="annotations.csv"/>
        </test>
    </tests>

    <help><![CDATA[
    TODO: Fill in help.
    ]]></help>

    <expand macro="citations"/>
</tool>