<macros>
    <token name="@TOOL_VERSION@">0.10.0</token>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">r-recetox-aplcms</requirement>
        </requirements>
    </xml>

    <xml name="creator">
        <creator>
            <person
                givenName="Maksym"
                familyName="Skoryk"
                url="https://github.com/maximskorik"
                identifier="0000-0003-2056-8018" />
            <person
                givenName="Matej"
                familyName="Troják"
                url="https://github.com/xtrojak"
                identifier="0000-0003-0841-2707" />
            <person
                givenName="Martin"
                familyName="Čech"
                url="https://github.com/martenson"
                identifier="0000-0002-9318-1781" />
            <person
                givenName="Jiří"
                familyName="Novotný"
                url="https://github.com/xtracko"
                identifier="0000-0001-5449-3523" />
            <organization
                url="https://www.recetox.muni.cz/"
                email="GalaxyToolsDevelopmentandDeployment@space.muni.cz"
                name="RECETOX MUNI"/>
        </creator>
    </xml>

    <xml name="remove_noise_params">
        <param name="min_pres" type="float" value="0.5" label="min_pres"
               help="The minimum proportion of presence in the time period for a series of signals grouped by m/z to be considered a peak." />
        <param name="min_run" type="float" value="12" label="min_run"
               help="The minimum length of elution time for a series of signals grouped by m/z to be considered a peak." />
        <param name="mz_tol" type="float" value="1e-05" label="mz_tol"
               help="The m/z tolerance level for the grouping of data points. This value is expressed as the fraction of the m/z value. This value, multiplied by the m/z value, becomes the cutoff level. The recommended value is the machine's nominal accuracy level. Divide the ppm value by 1e6. For FTMS, 1e-5 is recommended." />
        <param name="baseline_correct" type="float" value="0" label="baseline_correct"
               help="After grouping the observations, the highest intensity in each group is found. If the highest is lower than this value, the entire group will be deleted. The default value is NA, in which case the program uses a percentile of the height of the noise groups. If given a value, the value will be used as the threshold, and baseline.correct.noise.percentile will be ignored." />
        <param name="baseline_correct_noise_percentile" type="float" value="0.05" label="baseline_correct_noise_percentile"
               help="The percentile of signal strength of those EIC that don't pass the run filter, to be used as the baseline threshold of signal strength." />
        <param name="intensity_weighted" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="intensity_weighted"
               help="Whether to weight the local density by signal intensities in initial peak detection." />
    </xml>

    <xml name="generate_feature_table_params">
        <param name="bandwidth" type="float" value="0.5" label="bandwidth"
                   help="A value between zero and one. Multiplying this value to the length of the signal along
                   the time axis helps determine the bandwidth in the kernel smoother used for peak identification." />
        <param name="min_bandwidth" type="float" optional="true" label="min_bandwidth"
               help="The minimum bandwidth to use in the kernel smoother." />
        <param name="max_bandwidth" type="float" optional="true" label="max_bandwidth"
               help="The maximum bandwidth to use in the kernel smoother." />
        <param name="sd_cut_min" type="float" value="0.01" label="sd_cut_min"
               help="The minimum standard deviation of a feature to be not eliminated." />
        <param name="sd_cut_max" type="float" value="500" label="sd_cut_max"
               help="The maximum standard deviation of a feature to be not eliminated." />
        <param name="sigma_ratio_lim_min" type="float" value="0.01" label="sigma_ratio_lim_min"
               help="The lower limit of the believed ratio range between the left-standard deviation and the right-standard deviation of the bi-Gaussian function used to fit the data." />
        <param name="sigma_ratio_lim_max" type="float" value="100" label="sigma_ratio_lim_max"
               help="The upper limit of the believed ratio range between the left-standard deviation and the right-standard deviation of the bi-Gaussian function used to fit the data." />
        <param name="shape_model" type="select" display="radio" label="shape_model"
               help="The mathematical model for the shape of a peak. There are two choices - bi-Gaussian and Gaussian. When the peaks are asymmetric, the bi-Gaussian is better.">
            <option value="Gaussian">Gaussian</option>
            <option value="bi-Gaussian" selected="true">bi-Gaussian</option>
        </param>
        <param name="peak_estim_method" type="select" display="radio" label="peak_estim_method"
               help="The estimation method for the bi-Gaussian peak model. Two possible values: moment and EM.">
            <option value="moment" selected="true">Moment</option>
            <option value="EM">EM</option>
        </param>
        <param name="moment_power" type="float" value="1" label="moment_power"
               help="The power parameter for data transformation when fitting the bi-Gaussian or Gaussian mixture model in an EIC." />
        <param name="component_eliminate" type="float" value="0.01" label="component_eliminate"
               help="In fitting mixture of bi-Gaussian (or Gaussian) model of an EIC, when a component accounts for a proportion of intensities less than this value, the component will be ignored." />
        <param name="BIC_factor" type="float" value="2.0" label="BIC_factor"
               help="The factor that is multiplied on the number of parameters to modify the BIC criterion. If larger than 1, models with more peaks are penalized more." />
    </xml>

    <xml name="compute_clusters_params">
        <param name="mz_tol_relative" type="float" optional="true" label="mz_tol_relative"
               help="Relative m/z tolerance to use for grouping features." />
        <param name="mz_tol_absolute" type="float" label="mz_tol_absolute" value="1e-05"
               help="Absolute m/z tolerance to use for grouping features." />
        <param name="mz_max_diff" type="float" label="mz_max_diff" value="0.01"
               help="Maximum difference between feature m/z values to belong to the same cluster." />
        <param name="rt_tol_relative" type="float" optional="true" label="rt_tol_relative"
               help="Relative retention time tolerance to use for grouping features." />
    </xml>

    <xml name="recover_weaker_params">
        <param name="mz_tol" type="float" value="1e-05" label="mz_tol"
               help="The m/z tolerance level for the grouping of data points. This value is expressed as the
               fraction of the m/z value. This value, multiplied by the m/z value, becomes the cutoff level.
               The recommended value is the machine's nominal accuracy level. Divide the ppm value by 1e6.
               For FTMS, 1e-5 is recommended." />
        <param name="recover_mz_range" type="float" optional="true" label="recover_mz_range"
               help="The m/z around the feature m/z to search for observations. The default value is NA, in which
               case 1.5 times the m/z tolerance in the aligned object will be used." />
        <param name="recover_rt_range" type="float" optional="true" label="recover_rt_range"
               help="The retention time around the feature retention time to search for observations.
               The default value is NA, in which case 0.5 times the retention time tolerance in the aligned
                object will be used." />
        <param name="use_observed_range" type="boolean" checked="true" truevalue="TRUE" falsevalue="FALSE"
               label="use_observed_range" help="If the value is true, the actual range of the observed locations of
               the feature in all the spectra will be used." />
        <param name="recover_min_count" type="integer" value="3" label="recover_min_count"
               help="The minimum number of raw data points to be considered as a true feature." />
        <param name="bandwidth" type="float" value="0.5" label="bandwidth"
               help="A value between zero and one. Multiplying this value to the length of the signal along
               the time axis helps determine the bandwidth in the kernel smoother used for peak identification." />
        <param name="min_bandwidth" type="float" optional="true" label="min_bandwidth"
               help="The minimum bandwidth to use in the kernel smoother." />
        <param name="max_bandwidth" type="float" optional="true" label="max_bandwidth"
               help="The maximum bandwidth to use in the kernel smoother." />
        <param name="intensity_weighted" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE"
               label="intensity_weighted" help="Whether to weight the local density by signal intensities in initial peak detection." />
    </xml>

    <xml name="citations">
        <citations>
            <citation type="doi">10.1093/bioinformatics/btp291</citation>
            <citation type="doi">10.1186/1471-2105-11-559</citation>
            <citation type="doi">10.1021/pr301053d</citation>
            <citation type="doi">10.1093/bioinformatics/btu430</citation>
            <yield />
        </citations>
    </xml>

    <token name="@GENERAL_HELP@">
        apLCMS is a software which generates a feature table from a batch of LC/MS spectra. The m/z and retention time
        tolerance levels are estimated from the data. A run-filter is used to detect peaks and remove noise.
        Non-parametric statistical methods are used to find-tune peak selection and grouping. After retention time
        correction, a feature table is generated by aligning peaks across spectra. For further information on apLCMS
        please refer to https://mypage.cuhk.edu.cn/academics/yutianwei/apLCMS/.
    </token>
</macros>
